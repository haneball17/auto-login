# Windows11 游戏自动登录与签到自动化项目 开发计划（MVP + PyQt6）

## 1. 目标与范围

目标：在 Windows11 上稳定执行每日两次登录周期，支持账号池轮换、网页登录、客户端操作、证据留存，并提供一个简洁的 PyQt6 前端用于配置与查看执行状态/日志。

范围（MVP）：
- 调度：默认 07:00±3 分钟、13:00±3 分钟随机窗口，支持切换固定时间
- 账号池：轮换执行，单账号失败最大重试 2 次（可配置）
- 流程：启动器 -> 网页登录 -> 等待客户端 -> 选频道 -> 选角色 -> 进入游戏 -> 等待 30 秒 -> 退出
- 证据：截图/HTML/堆栈留存，保留 7 天（可配置）
- 前端：配置编辑、开始/停止/强制停止/立即执行一次、账号级状态与日志查看

非范围：
- 复杂 UI 设计与多端支持
- 退出游戏的“结束游戏按钮”方案
- 生产环境通知系统（邮件/IM）

## 2. 约束与前置条件

- Windows11 实际运行；Linux 仅保证测试可运行
- 默认分辨率 1920×1440，DPI 150%，均可配置
- 登录页无验证码/二次验证
- 前端仅编辑 config.yaml，不编辑 .env
- 日志按日期分割保存
- 代码风格遵循 PEP 8

## 3. 目录结构（根目录直接放置）

```text
.
├─ pyproject.toml
├─ poetry.lock
├─ README.md
├─ config.yaml
├─ .env
├─ anchors/
├─ logs/
├─ evidence/
├─ data/
│  ├─ state.json
│  └─ stop.flag
├─ src/
│  ├─ main.py
│  ├─ ui.py
│  ├─ config.py
│  ├─ runner.py
│  ├─ state.py
│  ├─ web_login.py
│  ├─ ui_ops.py
│  ├─ process_ops.py
│  ├─ evidence.py
│  └─ logger.py
└─ tests/
```

## 4. 里程碑计划（建议 3~4 天）

### M1：工程骨架 + 配置 + 日志（0.5 天）
- Poetry 初始化，依赖锁定
- config.yaml + .env 读取（pydantic-settings 默认规则）
- logger 按日期分割日志
- 基础运行入口（main.py）

交付物：
- 可运行的空流程框架
- 日志输出到 logs/YYYY-MM-DD.log

### M2：执行能力（1 天）
- 启动器与进程控制（process_ops）
- 窗口/截图/模板匹配/点击（ui_ops）
- 网页登录（web_login）

交付物：
- 单账号流程的关键步骤可跑通（含失败证据）

### M3：流程编排 + 状态 + 重试（0.5 天）
- runner：账号轮换、失败重试、随机/固定调度
- state.json 读写
- stop.flag 优雅停止

交付物：
- 账号池轮换与重试策略可运行
- 立即执行一次（--once）可用

### M4：证据留存 + 清理（0.5 天）
- 证据结构化保存（截图/HTML/堆栈）
- 保留 7 天自动清理

交付物：
- evidence 目录稳定输出，自动清理可验证

### M5：PyQt6 前端（0.5 天）
- 设置页：原始 YAML 编辑器
- 执行页：账号级 + 当前步骤
- 日志页：历史文件浏览、关键字过滤、实时滚动
- 控制：开始/停止/强制停止/立即执行一次

交付物：
- ui.py 可独立启动并联动运行

### M6：测试与稳定性（0.5 天）
- config/state/schedule/match 单元测试
- Windows 路径与异常边界测试
- 日志/证据/退出流程回归检查

交付物：
- tests 可在 60s 内完成

## 5. 关键实现要点

- 函数扁平化，避免不必要的类与层级
- 调度默认随机窗口，允许切换固定时间
- 账号失败重试上限 2 次，超过即记录失败并跳过
- stop.flag 作为优雅停止信号，必要时提供强制结束
- UI 与核心逻辑解耦：前端仅调度入口与读取状态/日志

## 6. 验收标准（MVP）

- 两次登录周期在随机窗口内稳定触发
- 多账号轮换可执行，失败重试与记录正确
- 证据留存完整，可追溯
- 前端可编辑 config.yaml，控制运行并查看日志与执行状态

## 7. 风险与应对

- 分辨率/DPI 变化：将窗口与 DPI 配置化，并在启动时校验
- 游戏 UI 变化：锚点图片可替换，阈值可配置
- 自动化误操作：限制运行时人工操作，必要时暂停
